<launch>

  <!-- pink drone: Vicon identifies as Debbie -->
  <!-- control via WiFi dongle: ip is 192.168.1.1 -->

  <arg name="drone_ip" default="192.168.1.1" />
  <arg name="drone_frame" default="vicon/Debbie/Debbie" />
  <arg name="drone_name" default="pink_ardrone" />
  <arg name="image" default="false" />

  <include file="$(find vicon_bridge)/launch/vicon.launch" />

  <node name="pos_to_tf" pkg="brl_drones" type="pos_to_tf.py" />

  <node name="battery" pkg="brl_parrots" type="battery_monitor.sh" output="screen" />

  <include file="$(find brl_parrots)/launch/ardrone_follow_tf.launch">
    <arg name="panel" value="True" />
    <arg name="image" value="$(arg image)" />
    <arg name="drone_frame" value="$(arg drone_frame)"/>
    <arg name="drone_name" value="$(arg drone_name)"/>
    <arg name="drone_ip" value="$(arg drone_ip)" />
    <arg name="target_frame" value="target" />
  </include>

  <!-- turn off integral action - causing problems, and that's what the ILC is for anyway -->
  <param name="control/pitch/init_gains/ki" type="double" value="0.0" />
  <param name="control/roll/init_gains/ki" type="double" value="0.0" />

  <!-- and retune to try and reduce oscillations -->
  <param name="control/pitch/init_gains/kp" type="double" value="0.01" />
  <param name="control/roll/init_gains/kp" type="double" value="0.01" />
  <param name="control/pitch/init_gains/kd" type="double" value="0.1" />
  <param name="control/roll/init_gains/kd" type="double" value="0.1" />

  <node name="rviz" pkg="rviz" type="rviz" args="-d $(find brl_drones)/urdf/drones.rviz" respawn="true" />

</launch>
